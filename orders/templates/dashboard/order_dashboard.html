{% extends "orders/base.html" %}

{% block content %}
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">All User Orders</h2>
    <a href="{% url 'dashboard-home' %}" class="btn btn-secondary">Back to Dashboard</a>
  </div>

  <div class="table-responsive">
    <table class="table table-striped text-center align-middle">
      <thead class="table-dark">
        <tr>
          <th>User</th>
          <th>Phone</th>
          <th>Address</th>
          <th>Items Ordered</th>
          <th>Quantity</th>
          <th>Total Amount</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>{{ order.user.username|default:order.full_name }}</td>
          <td>{{ order.phone }}</td>
          <td>{{ order.address }}</td>
          <td>
            <ul class="list-unstyled mb-0">
              {% for oi in order.items.all %}
              <li>{{ oi.item.name }}</li>
              {% endfor %}
            </ul>
          </td>
          <td>
            <ul class="list-unstyled mb-0">
              {% for oi in order.items.all %}
              <li>{{ oi.quantity }}</li>
              {% endfor %}
            </ul>
          </td>
          <td>{{ order.total_price }} RWF</td>
          <td>
            <span class="badge 
              {% if order.status == 'pending' %}bg-warning
              {% elif order.status == 'preparing' %}bg-info
              {% elif order.status == 'delivered' %}bg-success
              {% elif order.status == 'cancelled' %}bg-danger
              {% else %}bg-secondary{% endif %}">
              {{ order.get_status_display }}
            </span>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="text-center text-muted py-4">No orders yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<style>
@media (max-width: 576px) {
  .table thead { display: none; }
  .table tr { display: block; margin-bottom: 1rem; border: 1px solid #eee; border-radius: 8px; padding: .5rem; }
  .table td { display: flex; justify-content: space-between; }
  .table td::before { content: attr(data-label); font-weight: 600; margin-right: 1rem; }
}
</style>
{% endblock %}
