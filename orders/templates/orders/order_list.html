{% extends "orders/base.html" %}
{% block content %}
<h2>My Orders</h2>

{% if orders %}
  {% for order in orders %}
    <div class="card mb-3">
      <div class="card-header d-flex justify-content-between">
        <span>
          <strong>Order #{{ order.id }}</strong> — {% if order.created_at %}{{ order.created_at|date:"Y-m-d H:i" }}{% endif %} — 
          <span class="{% if order.status == 'cancelled' %}text-danger{% endif %}">{{ order.status }}</span>
        </span>
        <span>Total: {{ order.total_price }} RWF</span>
      </div>
      <div class="card-body">
        <h5>Items:</h5>
        <ul class="list-group">
          {% for order_item in order.items.all %}
            <li class="list-group-item d-flex justify-content-between">
              <span>{{ order_item.item.name }} × {{ order_item.quantity }}</span>
              <span>{{ order_item.price }} RWF</span>
            </li>
          {% empty %}
            <li class="list-group-item">No items in this order.</li>
          {% endfor %}
        </ul>
      </div>
      <div class="card-footer d-flex justify-content-between align-items-center">
        <div>Total Items: {{ order.items.count }}</div>
        {% if order.status in 'pending preparing' %}
        <form method="post" action="{% url 'orders:cancel-order' order.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger btn-sm">Cancel Order</button>
        </form>
        {% endif %}
      </div>
    </div>
  {% endfor %}
{% else %}
  <p>You have no orders yet.</p>
{% endif %}

{% endblock %}
